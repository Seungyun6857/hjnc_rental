{% extends "base_admin.html" %}

{% block content %}
<h3 class="mb-4">í˜‘ë ¥ì—…ì²´ ì£¼ì†Œë¡</h3>

<!-- âœ… ì—‘ì…€ ì—…ë¡œë“œ / ë‹¤ìš´ë¡œë“œ + ì‹ ê·œ ë“±ë¡ ë²„íŠ¼ -->
<div class="d-flex justify-content-end my-2 gap-2">
  <form action="/admin/contacts/import_excel" method="POST" enctype="multipart/form-data" class="d-flex align-items-center gap-2">
    <input type="file" name="file" accept=".xlsx" required class="form-control form-control-sm" style="max-width: 200px;">
    <button class="btn btn-primary btn-sm">ì—‘ì…€ ì—…ë¡œë“œ</button>
  </form>
  <a href="/admin/contacts/export_excel" class="btn btn-success btn-sm">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</a>

  <!-- â–¶ ì‹ ê·œ ë“±ë¡(ëª¨ë‹¬ ì˜¤í”ˆ) -->
  <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#vendorCreateModal">
    ì‹ ê·œ ë“±ë¡
  </button>
</div>

<!-- âœ… ì—…ì²´ ëª©ë¡ í…Œì´ë¸” -->
<div class="table-responsive mt-3">
  <table class="table table-bordered table-hover align-middle text-center">
    <thead class="table-light">
      <tr>
        <th>ì—…ì²´ëª…</th>
        <th>ë‹´ë‹¹ì</th>
        <th>ì—°ë½ì²˜</th>
        <th>ê·¸ë£¹</th>
        <th>ë“±ë¡ì¼</th>
        <th>ë©”ëª¨</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody id="partnersTbody">
      {% for company in companies %}
      <tr data-id="{{ company.id }}">
        <td>{{ company.name }}</td>
        <td>{{ company.manager }}</td>
        <td>{{ company.phone }}</td>
        <td>{{ company.group }}</td>
        <td>{{ company.created_at }}</td>
        <td class="text-truncate" style="max-width:260px">{{ company.memo }}</td>
        <td>
          <a href="{{ url_for('delete_contact', contact_id=company.id) }}"
             class="btn btn-outline-danger btn-sm"
             onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7">ë“±ë¡ëœ ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- âœ… ì‹ ê·œ ë“±ë¡ ëª¨ë‹¬ -->
<div class="modal fade" id="vendorCreateModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <form class="modal-content" action="/admin/contacts/add" method="POST" id="vendorCreateForm">
      <div class="modal-header">
        <h5 class="modal-title">í˜‘ë ¥ì—…ì²´ ì‹ ê·œ ë“±ë¡</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">ì—…ì²´ëª… <span class="text-danger">*</span></label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">ë‹´ë‹¹ì <span class="text-danger">*</span></label>
            <input type="text" name="manager" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">ì—°ë½ì²˜</label>
            <input type="text" name="phone" class="form-control" placeholder="010-0000-0000">
          </div>
          <div class="col-md-6">
            <label class="form-label">ê·¸ë£¹</label>
            <input type="text" name="group" class="form-control" placeholder="ì˜ˆ: LPR, UPS, PDA...">
          </div>
          <div class="col-12">
            <label class="form-label">ë©”ëª¨</label>
            <textarea name="memo" class="form-control" rows="3" placeholder="ê´€ë¦¬ ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <div class="me-auto small text-muted">* ì—…ì²´ëª…/ë‹´ë‹¹ìëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.</div>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
        <button type="submit" class="btn btn-primary">ì €ì¥</button>
      </div>
    </form>
  </div>
</div>

<!-- ğŸ” UX: ëª¨ë‹¬ ì—´ë¦¬ë©´ ì²« ì…ë ¥ì— ìë™ í¬ì»¤ìŠ¤ -->
<script>
  const vendorModalEl = document.getElementById('vendorCreateModal');
  vendorModalEl.addEventListener('shown.bs.modal', () => {
    const first = document.querySelector('#vendorCreateModal input[name="name"]');
    if (first) first.focus();
  });
</script>
{% endblock %}
