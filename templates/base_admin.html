<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}ê´€ë¦¬ì{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap / Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --sidebar-bg:#2b2f36;
      --sidebar-bg-2:#252932;
      --sidebar-txt:#e8eaed;
      --sidebar-muted:#a9b1bb;

      --footer-bg:#eef2f6;
      --footer-height:80px; /* admin_menuì—ì„œë§Œ ì“°ì„ */
    }

    html, body { height:100%; }
    /* ì „ì²´ ë¬¸ì„œì—ëŠ” ìŠ¤í¬ë¡¤ ê¸ˆì§€, ë³¸ë¬¸ ì˜ì—­ë§Œ ìŠ¤í¬ë¡¤ */
    body{ overflow:hidden; background:#f6f7fb; }

    /* ====== ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (ì‚¬ì´ë“œë°” + ë³¸ë¬¸ [+ í‘¸í„°]) ====== */
    .layout{
      height:100vh;
      display:grid;
      grid-template-columns:260px 1fr;
      grid-template-rows: 1fr;      /* ê¸°ë³¸: í‘¸í„° ì—†ìŒ */
    }
    /* admin_menu.html ì—ì„œë§Œ í‘¸í„° í–‰ ì¶”ê°€ */
    .layout.has-footer{
      grid-template-rows: 1fr var(--footer-height);
    }

    /* ====== Sidebar ====== */
    .sidebar{
      grid-column:1/2; grid-row:1/2;         /* ê¸°ë³¸: 1í–‰ë§Œ */
      background:var(--sidebar-bg);
      color:var(--sidebar-txt);
      display:flex; flex-direction:column;
      border-right:1px solid rgba(255,255,255,.08);
      min-height:0;
    }
    /* í‘¸í„°ê°€ ìˆì„ ë•ŒëŠ” 1~2í–‰ ì°¨ì§€ */
    .layout.has-footer .sidebar{ grid-row:1/3; }

    .sb-header{
      padding:16px 18px;
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .brand{ font-weight:800; letter-spacing:.5px; display:flex; align-items:center; gap:8px; color:var(--sidebar-txt); text-decoration:none; }
    .brand:hover{ opacity:.9; color:var(--sidebar-txt); }
    .brand .emoji{font-size:22px}
    .quick-icons .btn{color:var(--sidebar-muted); border:none;}

    .sb-section-title{ color:var(--sidebar-muted); font-size:12px; text-transform:uppercase; padding:10px 18px 6px; display:flex; align-items:center; gap:6px; }
    .sb-link, .sb-collapse-toggle{
      color:var(--sidebar-txt); text-decoration:none;
      padding:10px 18px; display:flex; align-items:center; gap:10px;
      transition:background .15s ease;
    }
    .sb-link:hover, .sb-collapse-toggle:hover{background:var(--sidebar-bg-2);}
    .sb-link.active{background:#1e293b; color:#fff;}
    .sb-icon{width:18px; text-align:center; color:var(--sidebar-muted);}
    .sb-chevron{margin-left:auto; color:var(--sidebar-muted); transition:transform .2s;}
    .sb-collapse-toggle.collapsed .sb-chevron{ transform:rotate(0); }
    .sb-collapse-toggle:not(.collapsed) .sb-chevron{ transform:rotate(180deg); }
    .sb-sub{background:rgba(255,255,255,.02);}
    .sb-sub .sb-link{padding-left:42px;}
    .sb-sub .sb-link .bi-dot{color:var(--sidebar-muted);}

    .sb-footer{
      margin-top:auto; padding:10px 12px; border-top:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; gap:8px; justify-content:space-between;
    }
    .lang-select .btn{color:var(--sidebar-txt); border-color:rgba(255,255,255,.2)}

    /* ====== ë³¸ë¬¸ ====== */
    .content{
      grid-column:2/3; grid-row:1/2;
      background:#f6f7fb;
      padding:20px;
      overflow:auto;     /* ë³¸ë¬¸ë§Œ ìŠ¤í¬ë¡¤ */
      min-height:0;      /* grid ìì‹ ìŠ¤í¬ë¡¤ì„ ìœ„í•´ í•„ìˆ˜ */
    }

    /* ====== í‘¸í„° (admin_menuì—ì„œë§Œ ë Œë”) ====== */
    .site-footer{
      grid-column:2/3; grid-row:2/3;
      background:var(--footer-bg);
      border-top:1px solid #dbe3ea;
      height:var(--footer-height);
      display:flex; align-items:center;
    }
    .site-footer .container{ padding:6px 12px; }
    .site-footer .container > *{ margin:0; line-height:1.25; }

    /* ì‘ì€ í™”ë©´ì—ì„œ ì‚¬ì´ë“œë°” ì‚´ì§ ì¢í˜ ì˜µì…˜ */
    @media (max-width:1200px){
      .layout{ grid-template-columns:240px 1fr; }
    }
    @media (max-width:992px){
      .layout{ grid-template-columns:220px 1fr; }
    }
  </style>
</head>
<body>
<!-- admin_menu.html ì—ì„œë§Œ has-footer í´ë˜ìŠ¤ë¥¼ ì£¼ê¸° ìœ„í•´ block ì œê³µ -->
<div class="layout {% block layout_extra_class %}{% endblock %}">

  <!-- ================= Sidebar ================= -->
  <aside class="sidebar">
    <div class="sb-header">
      <a class="brand" href="{{ url_for('admin_menu') }}" aria-label="ë©”ì¸ìœ¼ë¡œ ì´ë™">
        <span class="emoji">ğŸŒŒ</span>
        <span>Wooju Admin</span>
      </a>
      <div class="quick-icons d-flex align-items-center gap-1">
        <button class="btn position-relative" data-bs-toggle="modal" data-bs-target="#notifModal" title="ì•Œë¦¼">
          <i class="bi bi-bell"></i>
          <span class="position-absolute top-0 end-0 translate-middle p-1 bg-danger border border-light rounded-circle d-none" id="notifyDot"></span>
        </button>
        <button class="btn" data-bs-toggle="modal" data-bs-target="#settingsModal" title="ì„¤ì •">
          <i class="bi bi-gear"></i>
        </button>
      </div>
    </div>

    <div class="sb-section-title"><i class="bi bi-diagram-3"></i>ì‚¬ì´íŠ¸ ê´€ë¦¬</div>

    <!-- ëŒ€ì‹œë³´ë“œ -->
    <a class="sb-link {% if request.endpoint == 'admin_menu' %}active{% endif %}" href="{{ url_for('admin_menu') }}">
      <i class="sb-icon bi bi-house"></i>ëŒ€ì‹œë³´ë“œ
    </a>

    <!-- ì¥ë¹„ ê´€ë¦¬ -->
    <a class="sb-link {% if request.endpoint == 'admin_equipment' %}active{% endif %}" href="{{ url_for('admin_equipment') }}">
      <i class="sb-icon bi bi-hdd-stack"></i>ì¥ë¹„ ê´€ë¦¬
    </a>

    <!-- ëŒ€ì—¬/ë°˜ë‚© ê´€ë¦¬ -->
    {% set active_rental = request.endpoint in ['admin_rent_status', 'admin_return_status'] %}
    <a class="sb-collapse-toggle {{ '' if active_rental else 'collapsed' }}"
       data-bs-toggle="collapse" href="#sbRental" role="button"
       aria-expanded="{{ 'true' if active_rental else 'false' }}">
      <i class="sb-icon bi bi-box-seam"></i>ëŒ€ì—¬/ë°˜ë‚© ê´€ë¦¬
      <i class="sb-chevron bi bi-chevron-down"></i>
    </a>
    <div class="collapse sb-sub {{ 'show' if active_rental else '' }}" id="sbRental">
      <a class="sb-link {{ 'active' if request.endpoint == 'admin_rent_status' else '' }}"
         href="{{ url_for('admin_rent_status') }}">
        <i class="sb-icon bi bi-dot"></i>ëŒ€ì—¬ í˜„í™©
      </a>
      <a class="sb-link {{ 'active' if request.endpoint == 'admin_return_status' else '' }}"
         href="{{ url_for('admin_return_status') }}">
        <i class="sb-icon bi bi-dot"></i>ë°˜ë‚© í˜„í™©
      </a>
    </div>

    <!-- ê²Œì‹œíŒ -->
    {% set active_board = request.path.startswith('/admin/board') %}
    {% set is_board_type = request.endpoint == 'admin_board_type' %}
    {% set board_type = (request.view_args.get('board_type') if request.view_args else None) %}

    <a class="sb-collapse-toggle {{ '' if active_board else 'collapsed' }}"
       data-bs-toggle="collapse" href="#sbBoard" role="button"
       aria-expanded="{{ 'true' if active_board else 'false' }}">
      <i class="sb-icon bi bi-megaphone"></i>ê²Œì‹œíŒ
      <i class="sb-chevron bi bi-chevron-down"></i>
    </a>
    <div class="collapse sb-sub {{ 'show' if active_board else '' }}" id="sbBoard">
      <a class="sb-link
                {% if (is_board_type and board_type=='all') or request.endpoint=='admin_board' %}active{% endif %}"
         {% if has_endpoint('admin_board_type') %}
           href="{{ url_for('admin_board_type', board_type='all') }}"
         {% elif has_endpoint('admin_board') %}
           href="{{ url_for('admin_board') }}"
         {% else %} href="#"
         {% endif %}>
        <i class="sb-icon bi bi-dot"></i>ì „ì²´ ê²Œì‹œíŒ
      </a>

      <a class="sb-link {% if is_board_type and board_type=='work' %}active{% endif %}"
         {% if has_endpoint('admin_board_type') %}
           href="{{ url_for('admin_board_type', board_type='work') }}"
         {% elif has_endpoint('admin_board') %}
           href="{{ url_for('admin_board') }}"
         {% else %} href="#"
         {% endif %}>
        <i class="sb-icon bi bi-dot"></i>ì—…ë¬´ ê²Œì‹œíŒ
      </a>

      <a class="sb-link {% if is_board_type and board_type=='general' %}active{% endif %}"
         {% if has_endpoint('admin_board_type') %}
           href="{{ url_for('admin_board_type', board_type='general') }}"
         {% elif has_endpoint('admin_board') %}
           href="{{ url_for('admin_board') }}"
         {% else %} href="#"
         {% endif %}>
        <i class="sb-icon bi bi-dot"></i>ì¼ë°˜ ê²Œì‹œíŒ
      </a>

      <a class="sb-link {% if is_board_type and board_type=='data' %}active{% endif %}"
         {% if has_endpoint('admin_board_type') %}
           href="{{ url_for('admin_board_type', board_type='data') }}"
         {% elif has_endpoint('admin_board') %}
           href="{{ url_for('admin_board') }}"
         {% else %} href="#"
         {% endif %}>
        <i class="sb-icon bi bi-dot"></i>ìë£Œì‹¤
      </a>

      <a class="sb-link {% if is_board_type and board_type=='qna' %}active{% endif %}"
         {% if has_endpoint('admin_board_type') %}
           href="{{ url_for('admin_board_type', board_type='qna') }}"
         {% elif has_endpoint('admin_board') %}
           href="{{ url_for('admin_board') }}"
         {% else %} href="#"
         {% endif %}>
        <i class="sb-icon bi bi-dot"></i>Q&A
      </a>
    </div>

    <!-- ì£¼ì†Œë¡ -->
    <a class="sb-link {% if request.endpoint == 'admin_contacts' %}active{% endif %}" href="{{ url_for('admin_contacts') }}">
      <i class="sb-icon bi bi-people"></i>ì£¼ì†Œë¡
    </a>

    <!-- ===== ì‚¬ìš©ì ê´€ë¦¬ ===== -->
    {% set active_users = request.path.startswith('/admin/users') %}
    <a class="sb-collapse-toggle {{ '' if active_users else 'collapsed' }}"
       data-bs-toggle="collapse" href="#sbUsers" role="button"
       aria-expanded="{{ 'true' if active_users else 'false' }}">
      <i class="sb-icon bi bi-person-gear"></i>ì‚¬ìš©ì ê´€ë¦¬
      <i class="sb-chevron bi bi-chevron-down"></i>
    </a>
    <div class="collapse sb-sub {{ 'show' if active_users else '' }}" id="sbUsers">
      <a class="sb-link {{ 'active' if request.endpoint == 'admin_user_list' else '' }}"
         href="{{ url_for('admin_user_list') }}"><i class="sb-icon bi bi-dot"></i>ì‚¬ì› ë¦¬ìŠ¤íŠ¸</a>
      <a class="sb-link {{ 'active' if request.endpoint == 'admin_user_add' else '' }}"
         href="{{ url_for('admin_user_add') }}"><i class="sb-icon bi bi-dot"></i>ì‚¬ì› ì¶”ê°€</a>
      <a class="sb-link {{ 'active' if request.endpoint == 'admin_rank_dept_list' else '' }}"
         href="{{ url_for('admin_rank_dept_list') }}"><i class="sb-icon bi bi-dot"></i>ì§ê¸‰ ë° ë¶€ì„œ ë¦¬ìŠ¤íŠ¸</a>
    </div>

    <!-- ===== ì¸í”„ë¼ ëª¨ë‹ˆí„°ë§ (ìˆ˜ì • ì™„ë£Œ) ===== -->
    {% set role = (session.get('role') or session.get('user_role') or 'viewer') %}
    {% set infra_open = request.path.startswith('/admin/infra')
                        or request.path.startswith('/admin/network')
                        or request.path.startswith('/admin/cctv')
                        or request.path.startswith('/admin/servers')
                        or (request.endpoint and request.endpoint in [
                             'netmon_status','netmon_groups','netmon_reports',
                             'netmon_alerts','netmon_import'
                           ]) %}
    <a class="sb-collapse-toggle {{ '' if infra_open else 'collapsed' }}"
       data-bs-toggle="collapse" href="#sbNetmon" role="button"
       aria-expanded="{{ 'true' if infra_open else 'false' }}">
      <i class="sb-icon bi bi-diagram-3"></i>ì¸í”„ë¼ ëª¨ë‹ˆí„°ë§
      <i class="sb-chevron bi bi-chevron-down"></i>
    </a>
    <div class="collapse sb-sub {{ 'show' if infra_open else '' }}" id="sbNetmon">
      <a class="sb-link {{ 'active' if request.endpoint == 'netmon_status' else '' }}"
         {% if has_endpoint('netmon_status') %}
           href="{{ url_for('netmon_status') }}"
         {% else %} href="#"
         {% endif %}>
         <i class="sb-icon bi bi-activity"></i>ë„¤íŠ¸ì›Œí¬ ìƒíƒœ
      </a>

      <a class="sb-link {{ 'active' if request.endpoint == 'netmon_groups' else '' }}"
         {% if has_endpoint('netmon_groups') %}
           href="{{ url_for('netmon_groups') }}"
         {% else %} href="#"
         {% endif %}>
         <i class="sb-icon bi bi-collection"></i>ì¥ë¹„ ê·¸ë£¹
      </a>

      <a class="sb-link {{ 'active' if request.endpoint == 'netmon_reports' else '' }}"
         {% if has_endpoint('netmon_reports') %}
           href="{{ url_for('netmon_reports') }}"
         {% else %} href="#"
         {% endif %}>
         <i class="sb-icon bi bi-graph-up"></i>ë¦¬í¬íŠ¸
      </a>

      <a class="sb-link {{ 'active' if request.endpoint == 'netmon_alerts' else '' }}"
         {% if role == 'admin' and has_endpoint('netmon_alerts') %}
           href="{{ url_for('netmon_alerts') }}"
         {% else %} href="#"
         {% endif %}>
         <i class="sb-icon bi bi-bell"></i>ì•Œë¦¼ ì„¤ì •
      </a>

      <a class="sb-link {{ 'active' if request.endpoint == 'netmon_import' else '' }}"
         {% if role == 'admin' and has_endpoint('netmon_import') %}
           href="{{ url_for('netmon_import') }}"
         {% else %} href="#"
         {% endif %}>
         <i class="sb-icon bi bi-file-earmark-arrow-up"></i>ì¥ë¹„ ê°€ì ¸ì˜¤ê¸°(Excel)
      </a>
    </div>
    <!-- ===== /ì¸í”„ë¼ ëª¨ë‹ˆí„°ë§ ===== -->

    <div class="sb-section-title"><i class="bi bi-wrench-adjustable"></i>ì—…ë¬´ ë„êµ¬</div>
    <a class="sb-link {% if request.endpoint == 'calendar' %}active{% endif %}" href="{{ url_for('calendar') }}"><i class="sb-icon bi bi-calendar-event"></i>ìº˜ë¦°ë”</a>
    <a class="sb-link {% if request.endpoint == 'admin_manual' %}active{% endif %}" href="{{ url_for('admin_manual') }}"><i class="sb-icon bi bi-book"></i>ì—…ë¬´ ë©”ë‰´ì–¼</a>
    <a class="sb-link" href="https://outlook.office.com/mail/" target="_blank" rel="noopener"><i class="sb-icon bi bi-envelope-open"></i>ì›¹ë©”ì¼ ì—´ê¸°</a>
    <a class="sb-link" href="#" data-bs-toggle="modal" data-bs-target="#composeMailModal"><i class="bi bi-envelope"></i>ë¹ ë¥¸ ë©”ì¼ì“°ê¸°</a>

    <div class="sb-footer">
      <div class="dropup lang-select">
        <button class="btn btn-sm dropdown-toggle" data-bs-toggle="dropdown" id="btnLang">
          <i class="bi bi-translate me-1"></i><span id="langText">í•œêµ­ì–´</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-dark">
          <li><a class="dropdown-item lang-item" data-lang="ko">í•œêµ­ì–´</a></li>
          <li><a class="dropdown-item lang-item" data-lang="en">English</a></li>
          <li><a class="dropdown-item lang-item" data-lang="ja">æ—¥æœ¬èª</a></li>
        </ul>
      </div>
      <a href="{{ url_for('admin_logout') }}" class="text-decoration-none text-light small"><i class="bi bi-box-arrow-right me-1"></i>ë¡œê·¸ì•„ì›ƒ</a>
    </div>
  </aside>

  <!-- ================= Content ================= -->
  <main class="content">
    {% block content %}{% endblock %}
  </main>

  <!-- ================= Footer(ë¸”ë¡) ================= -->
  {% block footer %}{% endblock %}
</div>

<!-- ============ ì•Œë¦¼ ëª¨ë‹¬ ============ -->
<div class="modal fade" id="notifModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-sm">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title"><i class="bi bi-bell me-2"></i>ì•Œë¦¼</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body p-0"><ul class="list-group list-group-flush" id="notifList"></ul></div>
      <div class="modal-footer">
        <button class="btn btn-outline-secondary btn-sm" id="btnClearNotif">ëª¨ë‘ ì½ìŒ</button>
        <button class="btn btn-primary btn-sm" data-bs-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>

<!-- ============ ì„¤ì • ëª¨ë‹¬ ============ -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content" id="settingsForm">
      <div class="modal-header"><h5 class="modal-title"><i class="bi bi-gear me-2"></i>ì„¤ì •</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <div class="form-check form-switch mb-2"><input class="form-check-input" type="checkbox" id="optSidebarCompact"><label class="form-check-label" for="optSidebarCompact">ì‚¬ì´ë“œë°” ì»´íŒ©íŠ¸ ëª¨ë“œ</label></div>
        <div class="form-check form-switch mb-2"><input class="form-check-input" type="checkbox" id="optNotifySound"><label class="form-check-label" for="optNotifySound">ì•Œë¦¼ ë„ì°©ìŒ</label></div>
        <div class="mb-2">
          <label class="form-label">ê¸°ë³¸ ì–¸ì–´</label>
          <select class="form-select" id="optDefaultLang">
            <option value="ko">í•œêµ­ì–´</option><option value="en">English</option><option value="ja">æ—¥æœ¬èª</option>
          </select>
        </div>
        <div class="text-muted small">ì„¤ì •ì€ ì´ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤.</div>
      </div>
      <div class="modal-footer"><button class="btn btn-primary">ì €ì¥</button></div>
    </form>
  </div>
</div>

<!-- ============ ë¹ ë¥¸ ë©”ì¼ì“°ê¸° ëª¨ë‹¬ ============ -->
<div class="modal fade" id="composeMailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title"><i class="bi bi-envelope me-2"></i>ë¹ ë¥¸ ë©”ì¼ì“°ê¸°</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <form onsubmit="return sendQuickMail()">
          <div class="row g-3">
            <div class="col-md-8"><label class="form-label">ë°›ëŠ”ì‚¬ëŒ(ì‰¼í‘œ êµ¬ë¶„)</label><input class="form-control" id="mailTo" placeholder="user@domain.com, user2@domain.com" required></div>
            <div class="col-md-4"><label class="form-label">CC</label><input class="form-control" id="mailCc" placeholder="cc@domain.com"></div>
            <div class="col-12"><label class="form-label">ì œëª©</label><input class="form-control" id="mailSubject" required></div>
            <div class="col-12">
              <label class="form-label">ë‚´ìš©</label>
              <textarea class="form-control" id="mailBody" rows="7"></textarea>
              <div class="form-text">* mailto ë°©ì‹(ì²¨ë¶€ ë¶ˆê°€). ì²¨ë¶€ í•„ìš”ì‹œ ì›¹ë©”ì¼ì„ ì´ìš©í•˜ì„¸ìš”.</div>
            </div>
          </div>
          <button type="submit" class="d-none"></button>
        </form>
      </div>
      <div class="modal-footer">
        <a id="mailtoAnchor" class="btn btn-primary"><i class="bi bi-send"></i> ë©”ì¼ì•±ìœ¼ë¡œ ë³´ë‚´ê¸°</a>
        <button class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>

<!-- Script -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- í˜ì´ì§€ ê³µí†µ ìœ í‹¸ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  // -------- ì–¸ì–´ UI --------
  const langMap = { ko:'í•œêµ­ì–´', en:'English', ja:'æ—¥æœ¬èª' };
  const savedLang = localStorage.getItem('admin.lang') || 'ko';
  document.getElementById('langText').textContent = langMap[savedLang] || 'í•œêµ­ì–´';
  document.querySelectorAll('.lang-item').forEach(a=>{
    a.addEventListener('click', ()=>{
      const code = a.dataset.lang;
      localStorage.setItem('admin.lang', code);
      document.getElementById('langText').textContent = langMap[code] || 'í•œêµ­ì–´';
    });
  });

  // -------- ì•Œë¦¼(ë°ëª¨) --------
  const notifList = document.getElementById('notifList');
  const notifyDot = document.getElementById('notifyDot');
  if(!localStorage.getItem('admin.notif')){
    localStorage.setItem('admin.notif', JSON.stringify([
      {msg:'ìƒˆ ê³µì§€ì‚¬í•­ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', time:'ë°©ê¸ˆ'},
      {msg:'ë°˜ë‚© ì˜ˆì • ì¥ë¹„ê°€ ìˆìŠµë‹ˆë‹¤.', time:'1ì‹œê°„ ì „'}
    ]));
  }
  function renderNotif(){
    const arr = JSON.parse(localStorage.getItem('admin.notif') || '[]');
    notifList.innerHTML = arr.length
      ? arr.map(n=>`<li class="list-group-item small d-flex justify-content-between"><span>${n.msg}</span><span class="text-muted">${n.time}</span></li>`).join('')
      : '<li class="list-group-item text-muted small text-center py-3">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
    notifyDot.classList.toggle('d-none', arr.length===0);
  }
  renderNotif();
  document.getElementById('btnClearNotif').addEventListener('click', ()=>{
    localStorage.setItem('admin.notif','[]'); renderNotif();
  });

  // -------- ì„¤ì • ì €ì¥ + ì´ˆê¸° ë°˜ì˜ --------
  const cfg = JSON.parse(localStorage.getItem('admin.settings')||'{}');
  document.getElementById('optSidebarCompact').checked = !!cfg.compact;
  document.getElementById('optNotifySound').checked = !!cfg.nsound;
  document.getElementById('optDefaultLang').value = savedLang;
  // ì´ˆê¸° ë¡œë“œì‹œ ì»´íŒ©íŠ¸ ì ìš©
  if (cfg.compact) {
    document.querySelector('.layout').style.gridTemplateColumns = '220px 1fr';
  }

  document.getElementById('settingsForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const compact = document.getElementById('optSidebarCompact').checked;
    const nsound  = document.getElementById('optNotifySound').checked;
    const lang    = document.getElementById('optDefaultLang').value;
    localStorage.setItem('admin.settings', JSON.stringify({compact, nsound, lang}));
    localStorage.setItem('admin.lang', lang);
    document.getElementById('langText').textContent = langMap[lang] || 'í•œêµ­ì–´';
    document.querySelector('.layout').style.gridTemplateColumns = compact?'220px 1fr':'260px 1fr';
    if (window.bootstrap?.Modal) {
      bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
    }
  });

  // -------- ë¹ ë¥¸ ë©”ì¼ì“°ê¸°(mailto) --------
  function buildMailtoURL(to, cc, subject, body){
    const p = new URLSearchParams();
    if(cc)      p.set('cc', cc);
    if(subject) p.set('subject', subject);
    if(body)    p.set('body', body);
    return `mailto:${encodeURIComponent(to)}?${p.toString()}`;
  }
  function updateMailto(){
    const to = document.getElementById('mailTo').value.trim();
    const cc = document.getElementById('mailCc').value.trim();
    const theSubject = document.getElementById('mailSubject').value.trim();
    const theBody    = document.getElementById('mailBody').value;
    const a = document.getElementById('mailtoAnchor');
    if(!to){ a.removeAttribute('href'); a.classList.add('disabled'); return; }
    a.classList.remove('disabled');
    a.href = buildMailtoURL(to, cc, theSubject, theBody);
    a.target = '_blank'; a.rel='noopener';
  }
  function sendQuickMail(){ updateMailto(); document.getElementById('mailtoAnchor').click(); return false; }
  ['mailTo','mailCc','mailSubject','mailBody'].forEach(id=>{
    const el = document.getElementById(id); if(el) el.addEventListener('input', updateMailto);
  });
  window.sendQuickMail = sendQuickMail;
</script>

<!-- âœ… í˜ì´ì§€ ì „ìš© ìŠ¤í¬ë¦½íŠ¸(ì™¸ë¶€): admin_rent_status ë“±ì—ì„œ ì‚¬ìš© -->
<script defer src="{{ url_for('static', filename='js/admin_rent_status.js') }}"></script>

<!-- í˜ì´ì§€ê°€ ì¶”ê°€ë¡œ ì£¼ì…í•  ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ -->
{% block scripts %}{% endblock %}
{% block extra_js %}{% endblock %}
</body>
</html>
